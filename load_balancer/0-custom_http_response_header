#!/usr/bin/env bash
# This script installs Nginx and configures it to include a custom HTTP header (X-Served-By) with the hostname

# Update package lists and install nginx
apt-get update -y
apt-get install -y nginx

# Get the hostname of the machine
HOSTNAME=$(hostname)

# Configure Nginx to include the custom header
CONFIG_FILE="/etc/nginx/sites-available/default"

# Make sure the default config file exists
if [ -f "$CONFIG_FILE" ]; then
    # Insert header line inside the server block, after 'server_name _;'
    sed -i "/server_name _;/a \\tadd_header X-Served-By $HOSTNAME;" "$CONFIG_FILE"
fi

# Restart nginx to apply changes (not using systemctl)
service nginx restart
