#!/usr/bin/env bash
# This script installs and configures Nginx to include a custom HTTP header 'X-Served-By'.
# The header value is set to the server's hostname.

# Update package list and install nginx
sudo apt-get update -y
sudo apt-get install -y nginx

# Get the server's hostname
HOSTNAME=$(hostname)

# Add the custom header to Nginx configuration
sudo bash -c "cat > /etc/nginx/sites-available/default << EOF
server {
    listen 80 default_server;
    listen [::]:80 default_server;

    root /var/www/html;
    index index.html index.htm index.nginx-debian.html;

    server_name _;

    add_header X-Served-By \"$HOSTNAME\";  # Set the custom header with the hostname

    location / {
        try_files \$uri \$uri/ =404;
    }
}
EOF"

# Create a symbolic link to enable the site (if not already done)
sudo ln -s /etc/nginx/sites-available/default /etc/nginx/sites-enabled/ 2>/dev/null || true

# Restart nginx to apply changes
sudo systemctl restart nginx

# Note: Ensure that this script is run on both web-01 and web-02
