#!/usr/bin/env bash
# 0-custom_http_response_header
# Sandbox-friendly Nginx configuration for X-Served-By header

# Set your custom server name (simulate hostname)
# Change to "web-02" for the second instance
X_SERVED_BY="web-01"

# Check if Nginx is installed (sandbox often has it pre-installed)
if ! command -v nginx >/dev/null 2>&1; then
    echo "Nginx is not installed. Please install Nginx in the sandbox."
    exit 1
fi

# Backup default Nginx config
NGINX_CONF="/etc/nginx/sites-available/default"
if [ ! -f "${NGINX_CONF}.bak" ]; then
    cp "$NGINX_CONF" "${NGINX_CONF}.bak"
fi

# Add the custom header inside the server block
# Insert after "server_name _;"
sed -i "/server_name _;/a \ \ add_header X-Served-By $X_SERVED_BY always;" "$NGINX_CONF"

# Test and reload Nginx
nginx -t && nginx -s reload

echo "Custom header X-Served-By set to: $X_SERVED_BY"
